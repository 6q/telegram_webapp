FeedbackNow=function(){function u(a){if("undefined"===typeof html2canvas){return console.log("jQuery FeedbackNow: was not possible to instantiate the plugin, html2canvas is missing"),!1}if("undefined"===typeof jQuery.ui.draggable){return console.log("jQuery FeedbackNow: was not possible to instantiate the plugin, jQuery.ui.draggable is missing"),!1}if("undefined"===typeof jQuery.ui.resizable){return console.log("jQuery FeedbackNow: was not possible to instantiate the plugin, jQuery.ui.resizable is missing"),!1}if("undefined"===typeof $().modal){console.log("jQuery FeedbackNow: was not possible to instantiate the plugin, bootstrap modal is missing")}else{if("undefined"===typeof $().modal||"undefined"===typeof $().button){return console.log("jQuery FeedbackNow: was not possible to instantiate the plugin, bootstrap modal is missing"),!1}}return void 0!=a&&"object"==typeof a&&void 0!=a.sendTo&&""!=a.sendTo}var C=$("<style>.feedback-body{overflow-x:hidden!important;overflow-y:auto!important;padding:0!important}.feedback-body-with-highlight{overflow:hidden!important}.feedback-body-with-highlight .modal-header{cursor:move !important}.feedback-body .feedback-element-buttons{float:right}.feedback-body .feedback-element-buttons button{font-family:inherit;font-size:21px;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;filter:alpha(opacity=20);opacity:.2;-webkit-appearance:none;padding:0;cursor:pointer;background:0 0;border:0;margin-top:-2px;margin-left:5px}.feedback-body .feedback-element-dialog div.highlight{padding-left:1em}.feedback-body .modal-backdrop{display:none}.feedback-body .feedback-element-container-screenshot{position:absolute;width:100%;height:100%;left:0;top:0;overflow:hidden;background:#000;cursor:crosshair;-moz-user-select:none}.feedback-body .feedback-element-picture-screenshot{position:absolute;top:0;left:0;opacity:.6;z-index:0;-moz-user-select:none; -moz-appearance: none}.feedback-body .feedback-element-container-screenshot img,.feedback-body .feedback-element-container-screenshot *:not(.feedback_element_input){ -moz-user-select:none;-webkit-user-select:none;-webkit-user-drag:none; user-select: none; }.feedback-body .feedback-element-rectangle-show{position:absolute!important;background:#FFF;z-index:9;overflow:hidden;cursor:move}.feedback-body .feedback-element-rectangle-hide{position:absolute!important;background:#333;z-index:10;overflow:hidden;cursor:move}.feedback-body .feedback-element-rectangle-hide .feedback-element-rectangle-close{color:#666;z-index:3}.feedback-body .feedback-element-container-screenshot .ui-resizable-se{cursor:se-resize;width:16px;height:16px;right:0;bottom:0;position:absolute;border-right:3px #666 dotted;border-bottom:3px #666 dotted;color:#666}.feedback-body *:not(.feedback_element_input){-moz-user-select:none;-webkit-user-select:none;-webkit-user-drag:none}.feedback-element-rectangle-close{z-index:3;position:absolute;right:0;top:1px;font-size:20px;cursor:pointer;color:#333;display:block;width:24px;height:24px;padding:6px;border-radius:100%;line-height:.6;font-weight:700;-webkit-transition-property:all;-webkit-transition-duration:100ms}.feedback-body .feedback-element-dialog #message{resize:none}.feedback-body .input-error{border:1px solid red}.feedback-body .btn:active,.feedback-body .btn.active{background-image:none;outline:0;-webkit-box-shadow:inset 0 5px 10px rgba(0,0,0,.4);box-shadow:inset 0 5px 10px rgba(0,0,0,.4)}</style>"),H=$('<div class="modal fade feedback-element-dialog"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <div class="feedback-element-buttons"> <button type="button" class="feedback-element-restore" style="display:none"><span aria-hidden="true">&equiv;</span> <button type="button" class="feedback-element-minimize"><span aria-hidden="true">&minus;</span> <button type="button" class="feedback-element-close" data-dismiss="modal"><span aria-hidden="true">&times;</span> </div> <h4 class="modal-title">Feedback</h4> </div> <div class="modal-body"> <div class="row"> <div class="form-group clearfix"> <label class="col-md-2">Categories</label> <div class="col-sm-10"> <div class="" data-toggle="buttons" id="checks_groups"> <label class="btn btn-info"> <input type="checkbox" id="ideia"><i class="fa fa-lightbulb-o"></i>&nbsp;Idea</label> <label class="btn btn-success"> <input type="checkbox" id="comment"><i class="fa fa-comments"></i>&nbsp;Comment</label> <label class="btn btn-warning"> <input type="checkbox" id="error"><i class="fa fa-exclamation-triangle"></i>&nbsp;Error</label> <label class="btn btn-primary"> <input type="checkbox" id="other"><i class="fa fa-ellipsis-h"></i>&nbsp;Other</label> </div> </div> </div> <div class="form-group clearfix"> <label class="col-sm-2">E-mail</label> <div class="col-sm-10"> <input type="email" class="form-control feedback_element_input" id="email" placeholder="Your email" /> </div> </div> <div class="form-group clearfix"> <label for="message" class="col-sm-2">Message</label> <div class="col-sm-10"> <textarea class="form-control feedback_element_input" id="message" placeholder="Your Message" rows="5"></textarea> </div> </div> <div class="row"> <div class="col-xs-6"> <div class="form-group clearfix highlight"> <div class="btn-group" data-toggle="buttons" data-tooltip="tooltip" data-placement="top" title="Highlight the relevant areas for your feedback."> <label class="btn btn-primary"> <input type="checkbox" id="feedback_element_highlight"><i class="fa fa-picture-o">&nbsp;</i><span class="feedback-button-text">Highlight</span></label> </div> </div> </div> <div class="col-xs-6"> <div class="btn-group" style="display:none" data-toggle="buttons" id="feedback_container_highlight_controls"> <label class="btn btn-primary active" data-tooltip="tooltip" data-placement="top" title="Highlight the area."><i class="fa fa-eye"></i> <input type="radio" checked="true" id="feedback_element_show" name="feedback_rectangle_type"> Show</label> <label class="btn btn-primary" data-tooltip="tooltip" data-placement="top" title="Hide areas as personal informations"><i class="fa fa-stop"></i> <input type="radio" id="feedback_element_hide" name="feedback_rectangle_type"> Hide</label> </div> </div> </div> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal" id="feedback_element_close">Close</button> <button type="button" class="btn btn-primary" id="send_button">Send</button> </div> </div> </div> </div>'),v=$('<div class="modal fade feedback-message"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-body"> <button type="button" class="close" data-dismiss="modal">&times;</button> <h4><span class="text"></span></h4> </div> <div class="modal-footer"> <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button> </div> </div> </div> </div>'),w=$('<div class="modal fade feedback-loading"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-body"> <span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>&nbsp;&nbsp;<span class="text"></span></div> </div> </div> </div>');$("<style>.feedback-loading .glyphicon-refresh-animate{-webkit-animation:spin2 .7s infinite linear;animation-duration:.7s;animation-name:spin;animation-iteration-count:infinite;animation-direction:linear}@-webkit-keyframes spin2{from{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(360deg)}}@keyframes spin{from{transform:scale(1) rotate(0deg)}to{transform:scale(1) rotate(360deg)}}</style>").appendTo("body");var I=function(){var a,e;"undefined"!=typeof window.innerWidth?(a=window.innerWidth,e=window.innerHeight):"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?(a=document.documentElement.clientWidth,e=document.documentElement.clientHeight):(a=document.getElementsByTagName("body")[0].clientWidth,e=document.getElementsByTagName("body")[0].clientHeight);return{width:a,height:e}},D=function(){return 0<window.navigator.userAgent.indexOf("MSIE ")||navigator.userAgent.match(/Trident.*rv\:11\./)?!0:!1},r=[37,38,39,40],s=function(a){a=a||window.event;a.preventDefault&&a.preventDefault();a.returnValue=!1},J=function(a){for(var e=r.length;e--;){if(a.keyCode===r[e]){s(a);break}}},x=function(a){s(a)},E=function(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",x,!1);window.onmousewheel=document.onmousewheel=document.onkeydown=null},y=function(a,e){var f=v.clone();f.find(".text").text(a);f.modal({backdrop:"static",show:!0}).on("hidden.bs.modal",function(){f.remove()})},n={elem:null,show:function(a){var e=w.clone();e.find(".text").text(a);e.modal({backdrop:"static",show:!0}).on("hidden.bs.modal",function(){e.remove();n.elem=null});n.elem=e},hide:function(){null!=n.elem&&n.elem.modal("hide")}},F=function(a,e,f){$.effects&&$.effects.effect[e]?a.hide(e,100,f):a.hide(100,f)},t=function(a,e,f){$.effects&&$.effects.effect[e]?a.show(e,100,f):a.show(100,f)},B=function(a){var e=$.extend({feedbackBuilt:function(){},feedbackSent:function(){},feedbackCanceled:function(){}},a),f=null,c=null,h=null,k=null,z=null,A=!1,p=function(){return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())},r=function(){if(!c.data("minimized")){var l=c.find(".modal-content"),b=c.find(".modal-body"),d=c.find(".modal-footer"),K=c.find("button.feedback-element-minimize"),a=c.find("button.feedback-element-restore");F(d,"drop",function(){F(b,"drop",function(){var b={left:l.offset().left,bottom:$(window).height()-l.height()-(l.offset().top-l.parents(".feedback-element-dialog").offset().top)};h.appendTo(f);c.removeAttr("style");c.css(b);c.animate({left:0+(p()?0:15),bottom:0+(p()?0:15)},200,function(){K.hide();a.show();c.data("minimized",!0)})})})}},s=function(){if(c.data("minimized")){var l=c.find(".modal-body"),b=c.find(".modal-footer"),d=c.find("button.feedback-element-minimize"),a=c.find("button.feedback-element-restore"),f={left:($(window).width()-c.width())/2,bottom:$(window).height()-c.height()-30};c.data("highlighting")?t(l,"drop",function(){t(b,"drop",function(){d.show();a.hide();c.data("minimized",!1)})}):(c.css("top","auto"),c.animate(f,200,function(){null==h&&void 0==h||h.remove();c.removeAttr("style");t(l,"drop",function(){t(b,"drop",function(){d.show();a.hide();c.data("minimized",!1)})})}))}},u=function(c){var b=new Image;b.src=c.toDataURL("image/jpeg",.8);b.draggable=!1;return b},v=function(c){var b=c.mouseStart,d=c.mouseEnd;if(b.x==d.x||b.y==d.y){return!1}c=b.x>d.x?b.x-d.x:d.x-b.x;var a=b.y>d.y?b.y-d.y:d.y-b.y,f=b.x<d.x?b.x:d.x,b=b.y<d.y?b.y:d.y;k.find(".feedback-element-picture-screenshot");var g=$('<div class="feedback-element-rectangle-hide" />').css({width:c,height:a,left:f,top:b});g.draggable().resizable();$('<div aria-hidden="true" class="feedback-element-rectangle-close">&times;</div>').on("vclick",function(){g.fadeOut(200,function(){g.remove()})}).appendTo(g);return g},w=function(c){var b=c.mouseStart,d=c.mouseEnd;if(b.x==d.x||b.y==d.y){return!1}c=b.x>d.x?b.x-d.x:d.x-b.x;var a=b.y>d.y?b.y-d.y:d.y-b.y,f=b.x<d.x?b.x:d.x,b=b.y<d.y?b.y:d.y,d=k.find(".feedback-element-picture-screenshot"),g=d.clone();g.removeAttr("class");var e=$('<div class="feedback-element-rectangle-show" />').css({width:c,height:a,left:f,top:b});e.draggable({drag:function(c,b){g.css({left:0-b.position.left,top:0-b.position.top})}}).resizable();e.on("vmouseup vmousedown",function(){g.css({left:0-e.position().left,top:0-e.position().top})});g.css({position:"absolute",left:0-f,top:0-b,width:d.width(),height:d.height()});g.appendTo(e);$('<div aria-hidden="true" class="feedback-element-rectangle-close">&times;</div>').on("vclick",function(){e.fadeOut(200,function(){e.remove()})}).appendTo(e);return e},B=function(l){$(window).scrollTop(z);l=u(l);$(l).addClass("feedback-element-picture-screenshot").on("dragstart",function(b){b.preventDefault()});$(l).appendTo(k);var b=1;D()&&(b=1);$(l).css("zIndex",b).css("z-index",b);k.appendTo(f);c.css({left:0+(p()?0:15),bottom:0+(p()?0:15)});c.fadeIn("fast",function(){c.data("highlighting",!0)});c.find("#feedback_container_highlight_controls").show();var d=!1,a={x:0,y:0},e={x:0,y:0},g=0,m=0,h=$("<div />").css({border:"1px #FFF dashed",position:"absolute"}),b=2;D()&&(b=1010);$("<div />").css({position:"absolute",width:"100%",height:"100%",left:0,top:0,"z-index":b}).css("zIndex",b);$(l).on("vmousedown",function(b){d=!0;a.x=b.clientX;a.y=b.clientY});k.on("vmouseup",function(b){d&&(e.x=b.clientX,e.y=b.clientY,b=c.find("#feedback_container_highlight_controls").find("#feedback_element_show").is(":checked")?1:0,(b=1==b?w({mouseStart:a,mouseEnd:e}):v({mouseStart:a,mouseEnd:e}))&&b.appendTo(k));d=!1;h.remove()});k.on("vmousemove",function(b){d&&(g=b.clientX,m=b.clientY,h.css({width:a.x>g?a.x-g:g-a.x,height:a.y>m?a.y-m:m-a.y,left:a.x<g?a.x:g,top:a.y<m?a.y:m}),h.appendTo(k))});k.on("mouseleave",function(){d=!1;h.remove()});k.on("mouseenter",function(){0==h.size()&&(d=!1)});k.on("vmouseup",function(){d=!1;h.remove()})},L=function(){if(!c.data("highlighting")){var a=c.find(".modal-content"),b=f.find("#feedback_element_highlight").next().next(".feedback-button-text"),a={left:a.offset().left,bottom:$(window).height()-a.height()-(a.offset().top-a.parents(".feedback-element-dialog").offset().top)};h.appendTo(f);c.css(a);$("body").addClass("feedback-body-with-highlight");c.fadeOut("fast",function(){k=$('<div class="feedback-element-container-screenshot" />');z=$(window).scrollTop();html2canvas(document.body,{onrendered:function(a){var l=document.createElement("canvas"),e=a.width,f=a.height-(a.height-I().height),h=z;l.width=a.width;l.height=f;var k=l.getContext("2d");k.clearRect(0,0,a.width,f);k.drawImage(a,0,h,a.width,f,0,0,a.width,f);B(l);c.find("#feedback_element_show").click();window.addEventListener&&window.addEventListener("DOMMouseScroll",x,!1);window.onmousewheel=document.onmousewheel=x;document.onkeydown=J;c.draggable({handle:".modal-header",drag:function(b,a){c.css({bottom:"auto"})},containment:".modal",cursor:"move"});b.text("Cancel highlight");A=!0}})})}},M=function(){if(c.data("highlighting")){var a=f.find("#feedback_element_highlight").next().next(".feedback-button-text");c.draggable("destroy");var b={left:($(window).width()-c.width())/2,bottom:$(window).height()-c.height()-30};c.animate(b,200,function(){k.remove();null==h&&void 0==h||h.remove();c.removeAttr("style");c.data("highlighting",!1);$("body").removeClass("feedback-body-with-highlight");c.find("#feedback_container_highlight_controls").hide();E();a.text("Highlight");A=!1})}},N=function(){h=$("<style>.feedback-body .modal-dialog{position: fixed !important;margin:0 !important;z-index:99999999}</style>");f=H.clone();C.appendTo($("head"));p()&&f.find(".btn").addClass("btn-sm");c=f.find(".modal-dialog");var a=c.find("button.feedback-element-minimize"),b=c.find("button.feedback-element-restore"),d=f.find("#feedback_element_highlight"),k=c.find("#send_button"),n=c.find("#email"),g=c.find("#message"),m=c.find("#checks_groups");p()||f.find('[data-tooltip="tooltip"]').tooltip({container:".feedback-element-dialog .modal-body"});n.data("placeholder",n.attr("placeholder"));g.data("placeholder",g.attr("placeholder"));m.find(":checkbox").on("change",function(){0<m.find("input:checked").size()&&m.next(".error-span").remove()});c.data("minimized",!1);c.data("minimized",!1);c.data("highlighting",!1);f.modal({backdrop:"static",show:!1}).on("show.bs.modal",function(){$("body").addClass("feedback-body")}).on("hidden.bs.modal",function(){f.remove();$("body").removeClass("feedback-body");$("body").removeClass("feedback-body-with-highlight");C.remove();E();e.feedbackCanceled.call(this)});a.on("click",function(){r()});b.on("click",function(){s()});d.on("change",function(){$(this).is(":checked")?L():M()});k.on("click",function(){q.send()});e.feedbackBuilt.call(this)},O=function(a){return(new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i)).test(a)},P=function(){var a=c.find("#email"),b=c.find("#message"),d=c.find("#checks_groups"),e=$("<span class='error-span' />").text("Choose at least one").css({color:"#f00","margin-left":"1em"});return 0==d.find("input:checked").size()?(e.insertAfter(d),!1):""==a.val()?(a.addClass("input-error").attr("placeholder","This field is required").on("focus",function(){a.removeClass("input-error");a.attr("placeholder",a.data("placeholder"))}),!1):O(a.val())?""==b.val()?(b.addClass("input-error").attr("placeholder","This field is required").on("focus",function(){b.removeClass("input-error");b.attr("placeholder",b.data("placeholder"))}),!1):!0:(a.addClass("input-error").attr("placeholder","This email is invalid").on("change",function(){a.removeClass("input-error");a.attr("placeholder",a.data("placeholder"))}),!1)},Q=function(a){html2canvas(k.get(0),{onrendered:function(b){a.call(this,b)}})},G=function(a){q.close(function(){n.show("sending...");$(window).trigger("resize");$.post(e.sendTo,a,function(a){n.hide();e.feedbackSent.call(this);if(a){try{JSON.parse(a),void 0!==typeof a.status&&a?y("successfully sent!"):y("was not possible to send")}catch(c){y("was not possible to send, check the error logs"),console.log(c)}}})})},R=function(){if(P()){var a=c.find("#email"),b=c.find("#message"),d=c.find("#checks_groups"),e={email:a.val(),message:b.val(),categories:{ideia:d.find("#ideia").is(":checked")?!0:!1,comment:d.find("#comment").is(":checked")?!0:!1,error:d.find("#error").is(":checked")?!0:!1,other:d.find("#other").is(":checked")?!0:!1}};A?Q(function(a){e.imageData=a.toDataURL("image/jpeg",50);G(e)}):G(e)}};this.show=function(){N();f.modal("show")};this.close=function(a){if("function"==typeof a){f.on("hidden.bs.modal",function(){a.call(this)})}if(null==f){return!1}f.modal("hide")};this.send=function(){R()}},q;return{getInstance:function(a){if(!q){if(u(a)){q=new B(a)}else{return console.log("jQuery FeedbackNow: The parameters required are undefined"),!1}}return q}}}();